<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head('Transacciones')}"></head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>
<div class="container">
    <div class="card"
         th:with="typeIcons=${T(java.util.Map).of(
                 T(cl.casero.migration.domain.enums.TransactionType).SALE, 'ðŸ›’',
                 T(cl.casero.migration.domain.enums.TransactionType).PAYMENT, 'ðŸ’°',
                 T(cl.casero.migration.domain.enums.TransactionType).REFUND, 'â†©ï¸',
                 T(cl.casero.migration.domain.enums.TransactionType).DEBT_FORGIVENESS, 'â¤ï¸',
                 T(cl.casero.migration.domain.enums.TransactionType).INITIAL_BALANCE, 'âš–ï¸'
         )},
         typeLabels=${T(java.util.Map).of(
                 T(cl.casero.migration.domain.enums.TransactionType).SALE, 'Venta',
                 T(cl.casero.migration.domain.enums.TransactionType).PAYMENT, 'Abono',
                 T(cl.casero.migration.domain.enums.TransactionType).REFUND, 'DevoluciÃ³n',
                 T(cl.casero.migration.domain.enums.TransactionType).DEBT_FORGIVENESS, 'CondonaciÃ³n de deuda',
                 T(cl.casero.migration.domain.enums.TransactionType).INITIAL_BALANCE, 'Saldo inicial'
         )}">
        <h2>Transacciones</h2>
        <form method="get" class="transaction-filter">
            <label for="type">Tipo</label>
            <select id="type" name="type">
                <option value="" th:selected="${selectedType == null}">Todos</option>
                <option th:each="type : ${types}"
                        th:value="${type.name()}"
                        th:selected="${type == selectedType}"
                        th:text="${typeIcons.getOrDefault(type, 'ðŸ“„') + ' ' + typeLabels.getOrDefault(type, type.name())}">Tipo</option>
            </select>
            <button type="submit">Filtrar</button>
        </form>
        <div class="table-wrapper" th:if="${!transactionsPage.empty}">
            <table>
                <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Cliente</th>
                    <th>Tipo</th>
                    <th>Detalle</th>
                    <th>Monto</th>
                    <th>Saldo</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="tx : ${transactionsPage.content}">
                    <td th:text="${dateTimeUtil.format(tx.createdAt)}">01-ene-2024 10:30</td>
                    <td>
                        <a th:href="@{'/customers/' + ${tx.customer.id}}"
                           th:text="${tx.customer.name}">Cliente</a>
                    </td>
                    <td>
                        <span class="transaction-type-cell">
                            <span class="transaction-type-cell__icon"
                                  th:text="${typeIcons.getOrDefault(tx.type, 'ðŸ“„')}">ðŸ›’</span>
                            <span th:text="${typeLabels.getOrDefault(tx.type, tx.type.name())}">Tipo</span>
                        </span>
                    </td>
                    <td th:text="${tx.detail}">Detalle</td>
                    <td th:text="${currencyUtil.format(tx.amount)}">$0</td>
                    <td th:text="${currencyUtil.format(tx.balance)}">$0</td>
                </tr>
                </tbody>
            </table>
        </div>
        <p th:if="${transactionsPage.empty}">No hay transacciones registradas.</p>
        <nav class="pagination"
             th:if="${transactionsPage.totalPages > 1}"
             th:with="prev=${T(java.lang.Math).max(0, transactionsPage.number - 1)},
                      next=${T(java.lang.Math).min(transactionsPage.totalPages - 1, transactionsPage.number + 1)}">
            <a th:href="@{/transactions(page=${prev}, size=${transactionsPage.size}, type=${selectedType})}"
               th:classappend="${!transactionsPage.hasPrevious()} ? ' disabled'">
                Anterior
            </a>
            <span class="current"
                  th:text="${transactionsPage.number + 1} + ' / ' + ${transactionsPage.totalPages}">1 / 1</span>
            <a th:href="@{/transactions(page=${next}, size=${transactionsPage.size}, type=${selectedType})}"
               th:classappend="${!transactionsPage.hasNext()} ? ' disabled'">
                Siguiente
            </a>
        </nav>
    </div>
</div>
</body>
</html>
